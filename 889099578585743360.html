<?xml encoding="utf-8"?>

<p style="text-align: justify">
    Since the <a href="https://www.minds.com/blog/view/888772958717419520">other
    syntax highlighting experiment</a> yesterday had been such a success, I wanted
    to see how much I can improve the results and how far I could simplify the
    process. I had used pretty much the first syntax highlighter on the web that
    would output HTML, so the color scheme was not that amazing. In this post I
    have tried a different one, called <a href="http://hilite.me/">http://hilite.me/</a>.
    The beautiful result of this excellent tool is right here:
</p>

<!-- HTML generated using hilite.me -->
<div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><p style="white-space:pre; margin: 0; line-height: 65%"><span style="color: #f92672">import</span> <span style="color: #f8f8f2">requests</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">os</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">sys</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">xml.etree.ElementTree</span> <span style="color: #f92672">as</span> <span style="color: #f8f8f2">ET</span>
<span style="color: #f92672">from</span> <span style="color: #f8f8f2">requests.auth</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">HTTPBasicAuth</span>

<span style="color: #66d9ef">class</span> <span style="color: #a6e22e">GnuApi</span><span style="color: #f8f8f2">:</span>
    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">__init__</span><span style="color: #f8f8f2">(self,</span> <span style="color: #f8f8f2">user,</span> <span style="color: #f8f8f2">pw):</span>
        <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">_base_url</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;https://freezepeach.xyz&#39;</span>
        <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">_client</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">requests</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">session()</span>
        <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">_client</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">auth</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">HTTPBasicAuth(user,</span> <span style="color: #f8f8f2">pw)</span>

    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">post_status</span><span style="color: #f8f8f2">(self,</span> <span style="color: #f8f8f2">status):</span>
        <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">_client</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">post(</span>
            <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">_base_url</span><span style="color: #f92672">+</span><span style="color: #e6db74">&#39;/api/qvitter/statuses/update.json&#39;</span><span style="color: #f8f8f2">,</span>
            <span style="color: #f8f8f2">params</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">{</span><span style="color: #e6db74">&quot;status&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">status})</span>

    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">upload_image</span><span style="color: #f8f8f2">(self,</span> <span style="color: #f8f8f2">path):</span>
        <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">_client</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">post(</span>
            <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">_base_url</span><span style="color: #f92672">+</span><span style="color: #e6db74">&#39;/api/statusnet/media/upload&#39;</span><span style="color: #f8f8f2">,</span>
            <span style="color: #f8f8f2">files</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">{</span><span style="color: #e6db74">&#39;media&#39;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;media&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">open(path,</span> <span style="color: #e6db74">&#39;rb&#39;</span><span style="color: #f8f8f2">),</span> <span style="color: #e6db74">&#39;image/png&#39;</span><span style="color: #f8f8f2">)})</span>

    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">post_image</span><span style="color: #f8f8f2">(self,</span> <span style="color: #f8f8f2">path):</span>
        <span style="color: #f8f8f2">r</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">upload_image(path)</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">content</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">decode(</span><span style="color: #e6db74">&#39;utf8&#39;</span><span style="color: #f8f8f2">)</span>
        <span style="color: #f8f8f2">xml</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">ET</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">fromstring(r)</span>
        <span style="color: #f8f8f2">url</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">xml</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">findall(</span><span style="color: #e6db74">&#39;mediaurl&#39;</span><span style="color: #f8f8f2">)[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">]</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">text</span>
        <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">post_status(url)</span>

<span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">len(sys</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">argv)</span> <span style="color: #f92672">&gt;</span> <span style="color: #ae81ff">3</span><span style="color: #f8f8f2">:</span>
    <span style="color: #f8f8f2">user</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">sys</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">argv[</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">]</span>
    <span style="color: #f8f8f2">pw</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">sys</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">argv[</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">]</span>
    <span style="color: #f8f8f2">status</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">sys</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">argv[</span><span style="color: #ae81ff">3</span><span style="color: #f8f8f2">]</span>
<span style="color: #66d9ef">else</span><span style="color: #f8f8f2">:</span>
    <span style="color: #f8f8f2">user</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">os</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">environ[</span><span style="color: #e6db74">&#39;GNU_USER&#39;</span><span style="color: #f8f8f2">]</span>
    <span style="color: #f8f8f2">pw</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">os</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">environ[</span><span style="color: #e6db74">&#39;GNU_PW&#39;</span><span style="color: #f8f8f2">]</span>
    <span style="color: #f8f8f2">status</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&#39;</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">join(sys</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">stdin</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">readlines())</span>

<span style="color: #f8f8f2">api</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">GnuApi(user,</span> <span style="color: #f8f8f2">pw)</span>
<span style="color: #f8f8f2">api</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">post_status(status)</span>
</p></div>

<p style="text-align: justify">
    It is still little cumbersome at this point to insert code with highlighting.
    Specifically, I did not bother getting the line numbering to work, because
    the HTML table it would generate was simply refusing to align the columns side
    by side. The amount of tweaking that it took to get the code to work was not
    that dramatic, but Minds appears to strip out HTML "pre" tags, which the syntax
    highlihghter uses to preserve line breaks that HTML usually ignores. CSS came to
    the rescue rather easily: a simple style setting of "white-space: pre", after
    changing the "pre" tag to a simple paragraph "p" tag, took care of the formatting
    issue. The line height is usually set at 125 percent, which should be reduced to
    65 percent to obtain the result above. The color scheme being used is the the
    popular "monokai" and the source code is from <a href="https://github.com/UndeadMockingbird/AltTech/blob/master/gnu_social_post.py">one of my tools on GitHub</a>, to post
    to a GNU Social site. It's a stub class that should be extended, but provides a
    nice skeleton for whatever other functionality you might want to hang on it.
    Even though these extra steps are still required, the time investment required
    is low enough to insert plain text code into a blog post, without the task being
    excessively laborious.
</p>

<p style="text-align: justify">
    Often times, I have simply resorted to posting screenshots from an editor that
    was using highlighting already. However, you are then dependent on the resolution
    of the image for readability, you might have compression artifacts, it takes much
    longer to load, you cannot copy any of the code, and there are issues such as
    scaling the font in size. It's just kind of roundabout ugly to have to post source
    code as images.
</p>

<p>
    This was Undead Mockingbird with another blog post that I hope people find useful
    to get more out of your brave, new alt-tech world.
</p>
